{% extends "main/base.html" %}
{% load static %}

{% block content %}
{% block extra_head %}

<link rel="stylesheet" href="{% static 'style/edit_profile.css' %}">
<style>
    input[type="text"],
    input[type="email"],
    input[type="tel"],
    textarea,
    select {
        width: 100%;
        padding: 0.5rem 1rem;
        border: 1px solid #d1d5db;
        border-radius: 0.75rem;
        font-size: 0.95rem;
    }
    
    input[type="text"]:focus,
    input[type="email"]:focus,
    input[type="tel"]:focus,
    textarea:focus,
    select:focus {
        outline: none;
        border-color: #a855f7;
        box-shadow: 0 0 0 3px rgba(168, 85, 247, 0.1);
    }
    
    textarea {
        resize: vertical;
        min-height: 100px;
    }
</style>
{% endblock %}


<div class="min-h-screen bg-gradient-to-br from-gray-100 to-gray-200 flex">

    <!-- LEFT SIDEBAR -->
    <div class="w-64 bg-white shadow-lg p-6 border-r border-gray-100">
        <ul class="space-y-4 text-gray-700">
            <li>
                <a href="{% url 'profile' %}" class="hover:text-purple-600 transition">
                    Profile
                </a>
            </li>

            <li>
                <a href="{% url 'settings' %}" class="hover:text-purple-600 transition">
                    Settings
                </a>
            </li>

            <li class="bg-gradient-to-r from-purple-600 to-purple-500 text-white py-2 px-4 rounded-xl shadow-md font-medium">
                Edit Profile
            </li>

            <li>
                <a href="{% url 'skills' %}" class="hover:text-purple-600 transition">
                    Skills
                </a>
            </li>

            <li class="pt-10 text-red-500 hover:text-red-600 cursor-pointer transition">
                Log Out
            </li>
        </ul>
    </div>

    <!-- MAIN CONTENT -->
    <div class="flex-1 p-10">

        <h2 class="text-2xl font-semibold mb-8 text-gray-800">Edit Profile</h2>

        <div class="bg-white rounded-2xl shadow-lg p-10 border border-gray-100 relative overflow-hidden">

            <!-- PROFILE PHOTO -->
            <div class="flex justify-center mb-10">
                <div class="relative">
                    {% if profile.profile_image %}
                        <img src="{{ profile.profile_image.url }}"
                             class="w-28 h-28 rounded-full border-4 border-purple-200 shadow-md ring-4 ring-purple-100 object-cover">
                    {% else %}
                        <img src="{% static 'images/default_profile.svg' %}"
                             class="w-28 h-28 rounded-full border-4 border-purple-200 shadow-md ring-4 ring-purple-100">
                    {% endif %}

                    <label for="profile_image_input"
                           class="absolute bottom-1 right-1 bg-purple-600 text-white w-7 h-7 rounded-full flex items-center justify-center text-sm shadow hover:bg-purple-700 transition cursor-pointer">
                        âœŽ
                    </label>
                </div>
            </div>

            <form method="POST" enctype="multipart/form-data">
                {% csrf_token %}

                <!-- Hidden file input for profile image -->
                <input type="file" id="profile_image_input" name="profile_image" accept="image/*" style="display: none;">

                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">

                    <!-- FULL NAME -->
                    <div>
                        <label class="font-medium text-gray-700 block mb-2">Full Name</label>
                        {{ profile_form.full_name }}
                    </div>

                    <!-- EMAIL -->
                    <div>
                        <label class="font-medium text-gray-700 block mb-2">Email</label>
                        {{ user_form.email }}
                    </div>

                    <!-- PHONE NUMBER -->
                    <div>
                        <label class="font-medium text-gray-700 block mb-2">Phone Number</label>
                        {{ profile_form.phone_number }}
                    </div>

                    <!-- LOCATION -->
                    <div class="md:col-span-2">
                        <label class="font-medium text-gray-700 block mb-2">Location</label>
                        {{ profile_form.location }}
                    </div>

                    <!-- BIO -->
                    <div class="md:col-span-2">
                        <label class="font-medium text-gray-700 block mb-2">Bio</label>
                        {{ profile_form.bio }}
                    </div>

                    <!-- PROFILE IMAGE (Hidden but processed) -->
                    <div style="display: none;">
                        {{ profile_form.profile_image }}
                    </div>

                </div>

                <!-- BUTTONS -->
                <div class="flex justify-end mt-12 space-x-4">
                    <a href="{% url 'profile' %}"
                       class="px-6 py-2 border border-gray-300 rounded-xl hover:bg-gray-100 transition">
                        Back To Home
                    </a>

                    <button type="submit"
                            class="px-7 py-2.5 bg-gradient-to-r from-purple-600 to-purple-500 text-white rounded-xl shadow hover:shadow-lg hover:scale-[1.02] transition">
                        Save Changes
                    </button>
                </div>

            </form>
        </div>
    </div>
</div>

<script>
    // Handle profile image upload
    document.getElementById('profile_image_input').addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(event) {
                // Update the profile image preview
                const img = document.querySelector('.w-28.h-28.rounded-full');
                if (img) {
                    img.src = event.target.result;
                }
            };
            reader.readAsDataURL(file);
        }
    });

    // Trigger file input when edit button is clicked
    document.querySelector('label[for="profile_image_input"]').addEventListener('click', function(e) {
        e.preventDefault();
        document.getElementById('profile_image_input').click();
    });
</script>

{% endblock %}
