{% extends "main/base.html" %}
{% load static %}

{% block extra_head %}
<link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700;800&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="{% static 'style/edit_profile.css' %}?v=3">
{% endblock extra_head %}

{% block content %}
<div class="edit-shell">
    <div class="edit-hero">
        <div class="hero-left">
            {% if profile.profile_image %}
                <img src="{{ profile.profile_image.url }}" class="profile-avatar" alt="Profile image">
            {% else %}
                <div class="profile-avatar placeholder"></div>
            {% endif %}
            <div>
                <p class="eyebrow">Edit profile</p>
                <h1 class="hero-title">{{ profile.full_name|default:user.username }}</h1>
                <p class="hero-subtitle">Update your details so opportunities match who you are today.</p>
                <div class="hero-meta">
                    {% if profile.location %}<span class="meta-pill">üìç {{ profile.location }}</span>{% endif %}
                    {% if profile.role %}<span class="meta-pill">{{ profile.role|title }}</span>{% endif %}
                </div>
                <div class="hero-actions">
                    <a class="ghost-btn" href="{% url 'profile' %}">Back to profile</a>
                    <a class="ghost-btn" href="{% url 'skills' %}">Manage skills</a>
                </div>
            </div>
        </div>
        <div class="hero-stats">
            <div class="stat-chip">
                <span class="stat-label">Email</span>
                <span class="stat-value small">{{ user.email|default:"Not set" }}</span>
            </div>
            <div class="stat-chip">
                <span class="stat-label">Phone</span>
                <span class="stat-value small">{{ profile.phone_number|default:"Not set" }}</span>
            </div>
            <div class="stat-chip">
                <span class="stat-label">Location</span>
                <span class="stat-value small">{{ profile.location|default:"Add" }}</span>
            </div>
        </div>
    </div>

    <div class="edit-grid">
        <aside class="edit-sidebar">
            <p class="eyebrow">Navigation</p>
            <div class="link-stack">
                <a href="{% url 'profile' %}">Profile</a>
                <a href="{% url 'settings' %}">Settings</a>
                <span class="active-link">Edit profile</span>
                <a href="{% url 'skills' %}">Skills</a>
                <a class="danger" href="{% url 'logout' %}">Log out</a>
            </div>
        </aside>

        <div class="card form-card">
            <div class="card-header">
                <div>
                    <p class="eyebrow">Details</p>
                    <h2 class="card-title">Profile information</h2>
                    <p class="muted">Keep your contact and bio current so employers can reach you.</p>
                </div>
            </div>

            <form method="POST" enctype="multipart/form-data" class="form">
                {% csrf_token %}
                <input type="file" id="profile_image_input" name="profile_image" accept="image/*" hidden>

                <div class="avatar-row">
                    <div class="avatar-stack">
                        {% if profile.profile_image %}
                            <img src="{{ profile.profile_image.url }}" class="profile-avatar" alt="Profile image">
                        {% else %}
                            <div class="profile-avatar placeholder"></div>
                        {% endif %}
                        <label for="profile_image_input" class="icon-btn" title="Upload photo">‚úé</label>
                    </div>
                    <div class="muted">PNG or JPG up to 5MB.</div>
                </div>

                <div class="form-grid">
                    <div class="field">
                        <label>Full name</label>
                        {{ profile_form.full_name }}
                    </div>
                    <div class="field">
                        <label>Email</label>
                        {{ user_form.email }}
                    </div>
                    <div class="field">
                        <label>Phone number</label>
                        {{ profile_form.phone_number }}
                    </div>
                    <div class="field full">
                        <label>Location</label>
                        {{ profile_form.location }}
                    </div>
                    <div class="field full">
                        <label>Bio</label>
                        {{ profile_form.bio }}
                    </div>
                    <div style="display:none;">
                        {{ profile_form.profile_image }}
                    </div>
                </div>

                <div class="form-actions">
                    <a href="{% url 'profile' %}" class="ghost-btn">Cancel</a>
                    <button type="submit" class="primary-cta">Save changes</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    const fileInput = document.getElementById('profile_image_input');
    const avatarPreview = document.querySelector('.avatar-stack .profile-avatar');
    if (fileInput && avatarPreview) {
        fileInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (event) => {
                avatarPreview.src = event.target.result;
            };
            reader.readAsDataURL(file);
        });
    }
</script>
{% endblock content %}
