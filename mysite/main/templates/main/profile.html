{% extends "main/base.html" %}
{% load static %}

{% block extra_head %}
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'style/profile.css' %}?v=1">
{% endblock extra_head %}

{% block content %}
    <div class="profile-container">

        <div class="profile-banner">
             <img src="{% static 'images/banner.jpg' %}" class="banner-img">
        </div>

        <div class="profile-layout-wrapper">
            
            <div class="profile-sidebar">
                
                <div class="profile-header">
                    {% if profile.profile_image %}
                        <img src="{{ profile.profile_image.url }}" class="profile-img">
                    {% else %}
                        <img src="{% static 'images/default-pfp.png' %}" class="profile-img">
                    {% endif %}

                    <a href="{% url 'profile' %}" class="profile-name">{{ profile.full_name }}</a>
                    <p class="profile-role">{{ profile.bio }}</p>

                    <div class="profile-buttons">
                        <a href="{% url 'edit_profile' %}" class="edit-btn">Edit Profile</a>
                    </div>
                </div>

                <div class="profile-info">
                    <div class="info-card applications">
                        <h3>Applications</h3>
                        <p class="info-number">12</p>
                    </div>

                    <div class="info-card interviews">
                        <h3>Interviews</h3>
                        <p class="info-number">4</p>
                    </div>

                    <div class="info-card status">
                        <h3>Status</h3>
                        <p class="info-number status-good">Active</p>
                    </div>
                </div>

            </div>
            <div class="profile-main-content">
            <div class="profile-content-wrapper">
                <div class="profile-left-column">
    <!-- SKILLS -->
    <div class="skills-section">
        <h2>Skills & Competencies</h2>

        {% if profile.skills.exists %}
            <ul>
                {% for skill in profile.skills.all %}
                    <li>
                        <strong>{{ skill.name }}</strong> — {{ skill.level }}
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <p>No skills added yet.</p>
        {% endif %}
    </div>

    <!-- ✅ ADD JOB SUGGESTIONS RIGHT HERE -->
    <div class="job-suggestions">
    <h2 class="section-title">Job Suggestions for You</h2>
    <p class="suggestion-intro">Matches based on your skills</p>

    {% if suggestions %}
        <div class="job-list">
            {% for s in suggestions %}
                {% with job=s.job %}
                <div class="job-card">
                    <div class="job-info">
                        <h3 class="job-title">{{ job.title }}</h3>
                        <p class="job-company">{{ job.company_name|default:"Company not listed" }}</p>
                        <p class="job-location">{{ job.location|default:"Remote" }}</p>

                        <div class="job-badges">
                            {% if job.employment_type %}
                                <span class="pill">{{ job.get_employment_type_display }}</span>
                            {% endif %}
                            {% if job.working_schedule %}
                                <span class="pill">{{ job.get_working_schedule_display }}</span>
                            {% endif %}
                            {% for tag in job.skills.all %}
                                <span class="pill">{{ tag.name }}</span>
                            {% endfor %}
                        </div>

                        <p class="job-description">{{ job.description|default:"No description provided."|truncatewords:35 }}</p>
                    </div>

                    <div class="job-match">
                        <span>Skill Match</span>
                        <strong>{{ s.match_percent }}%</strong>
                    </div>

                    <div class="job-action">
                        <div style="display: flex; gap: 10px;">
                            <a href="{% url 'apply_job' job.id %}" class="apply-btn" style="flex: 1; text-align: center; padding: 10px 20px; color: white; background-color: #2c3e50; border-radius: 5px; text-decoration: none;">Apply Now</a>
                            <a href="{% url 'toggle_save_job' job.id %}" style="padding: 10px 15px; font-size: 18px; background-color: #fff3cd; border-radius: 5px; text-decoration: none; border: 1px solid #ffc107;" title="Save Job">
                                {% if job.saved_by.filter|length > 0 %}⭐{% else %}☆{% endif %}
                            </a>
                        </div>
                    </div>
                </div>
                {% endwith %}
            {% endfor %}
        </div>
    {% else %}
        <p>No job suggestions yet.</p>
    {% endif %}
</div>
                </div>
            </div>
            </div>
        </div>
    </div>
{% endblock content %}